<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>./static/js/main.js annotated source</title>
    <link rel="stylesheet" href="/codeframe/main.css">
</head>

<body>
    <main>
        <div class="line">
            <div class="doc">
                <h1>./static/js/main.js <span class="fade">annotated source</span></h1>
                <em><a class="back" href="/codeframe/">Back to index</a></em>
            </div>
            <pre></pre>
        </div>
        <div class="line"><div class="doc"><h2 id="codeframes-editor-component">Codeframe&#39;s editor component</h2>
</div><pre class="source javascript"><strong class="lineNumber">2</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">3</strong>const {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">4</strong>    StyledComponent,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">5</strong>    Record,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">6</strong>    Router,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">7</strong>} = Torus;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">8</strong></pre></div>
<div class="line"><div class="doc"><p>Utility function to fetch while bypassing the cache, and with some default options.</p>
</div><pre class="source javascript"><strong class="lineNumber">11</strong>const cfFetch = (uri, options) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">12</strong>    return fetch(uri, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">13</strong>        credentials: 'same-origin',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">14</strong>        ...options,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">15</strong>    });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">16</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">17</strong></pre></div>
<div class="line"><div class="doc"><p>This <code>api</code> object provides some utility methods we use to fetch and push stuff to and from the Codeframe internal API.</p>
</div><pre class="source javascript"><strong class="lineNumber">20</strong>const api = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">21</strong>    get: path =&#62; cfFetch(`/api${path}`, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">22</strong>        method: 'GET',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">23</strong>    }),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">24</strong>    post: (path, body) =&#62; cfFetch(`/api${path}`, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">25</strong>        method: 'POST',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">26</strong>        body: body,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">27</strong>    }),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">28</strong>    errlog: e =&#62; console.error(`Codeframe API error:\n\t${e}`),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">29</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">30</strong></pre></div>
<div class="line"><div class="doc"><p>Debounce coalesces multiple calls to the same function in a short period of time into one call, by cancelling subsequent calls within a given timeframe.</p>
</div><pre class="source javascript"><strong class="lineNumber">34</strong>const debounce = (fn, delayMillis) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">35</strong>    let lastRun = 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">36</strong>    let to = null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">37</strong>    return (...args) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">38</strong>        clearTimeout(to);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">39</strong>        const now = Date.now();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">40</strong>        const dfn = () =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">41</strong>            lastRun = now;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">42</strong>            fn(...args);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">43</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">44</strong>        if (now - lastRun &#62; delayMillis) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">45</strong>            dfn()</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">46</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">47</strong>            to = setTimeout(dfn, delayMillis);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">48</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">49</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">50</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">51</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>PreviewPane</code>  is the half-screen pane that shows a preview of the rendered Codeframe, alongside the URL and refresh buttons.</p>
</div><pre class="source javascript"><strong class="lineNumber">54</strong>class PreviewPane extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">55</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">56</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>Percentage of the editor size that the preview pane takes up.</p>
</div><pre class="source javascript"><strong class="lineNumber">58</strong>        this.paneWidth = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">59</strong></pre></div>
<div class="line"><div class="doc"><p>We create an iframe manually and insert it into the component DOM, so we can replace its URL when the preview URL changes, rather than simply having Torus set it and adding unnecessary history entries in the browser.</p>
</div><pre class="source javascript"><strong class="lineNumber">63</strong>        this.iframe = document.createElement('iframe');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">64</strong>        this.iframe.setAttribute('frameborder', 0);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">65</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">66</strong>        this.bind(frameRecord, data =&#62; this.render(data));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">67</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">68</strong>        this.selectInput = this.selectInput.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">69</strong>        this.handleRefresh = this.handleRefresh.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">70</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">71</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">72</strong>    setWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">73</strong>        this.paneWidth = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">74</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">75</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">76</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">77</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">78</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">79</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">80</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">81</strong>        justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">82</strong>        align-items: flex-start;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">83</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">84</strong>        flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">85</strong>        flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">86</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">87</strong>        border-right: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">88</strong>        @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">89</strong>            /* Overriding inline style */</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">90</strong>            width: 100% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">91</strong>            height: 50%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">92</strong>            border-right: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">93</strong>            border-bottom: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">94</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">95</strong>        .topBar {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">96</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">97</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">98</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">99</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">100</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">101</strong>            padding: 0 3px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">102</strong>            border-bottom: 4px dotted var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">103</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">104</strong>            height: 52px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">105</strong>            .embedded &#38; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">106</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">107</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">108</strong>            .inputContainer {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">109</strong>                box-sizing: content-box;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">110</strong>                flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">111</strong>                flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">112</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">113</strong>            input {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">114</strong>                display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">115</strong>                font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">116</strong>                font-weight: bold;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">117</strong>                height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">118</strong>                width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">119</strong>                box-shadow: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">120</strong>                outline: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">121</strong>                border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">122</strong>                padding: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">123</strong>                font-weight: normal;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">124</strong>                font-family: 'Menlo', 'Monaco', monospace;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">125</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">126</strong>            a {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">127</strong>                font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">128</strong>                flex-grow: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">129</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">130</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">131</strong>        iframe {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">132</strong>            height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">133</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">134</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">135</strong>            outline: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">136</strong>            border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">137</strong>            box-shadow: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">138</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">139</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">140</strong>        .refreshButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">141</strong>            font-size: 17px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">142</strong>            width: calc(.75rem + 17px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">143</strong>            height: calc(.75rem + 17px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">144</strong>            line-height: calc(.75rem + 18px);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">145</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">146</strong>            padding: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">147</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">148</strong>            flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">149</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">150</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">151</strong>            &#38;:active {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">152</strong>                color: #000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">153</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">154</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">155</strong>        .unsavedWarning {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">156</strong>            font-style: italic;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">157</strong>            white-space: nowrap;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">158</strong>            .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">159</strong>                font-style: initial;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">160</strong>                cursor: not-allowed;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">161</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">162</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">163</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">164</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">165</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">166</strong>    selectInput(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">167</strong>        evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">168</strong>        evt.target.select();</pre></div>
<div class="line"><div class="doc"><p>This is a weird and funky workaround for the fact that, in Safari, the selection made here from a focus event is cancelled immediately by a proceeding mouseup event, when it happens. So we <code>.preventDefault()</code> only the next immediate mouseup event.</p>
</div><pre class="source javascript"><strong class="lineNumber">172</strong>        const cancelMouseup = e =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">173</strong>            e.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">174</strong>            evt.target.removeEventListener('mouseup', cancelMouseup);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">175</strong>        };</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">176</strong>        evt.target.addEventListener('mouseup', cancelMouseup);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">177</strong>        gevent('preview', 'selecturl');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">178</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">179</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">180</strong>    handleRefresh() {</pre></div>
<div class="line"><div class="doc"><p>Force-refreshing the preview works by clearing the &quot;last url&quot; fetched, so it looks like the same URL is a new URL on next render.</p>
</div><pre class="source javascript"><strong class="lineNumber">183</strong>        this._lastURL = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">184</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">185</strong>        gevent('preview', 'refresh');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">186</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">187</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">188</strong>    safelySetIframeURL(url) {</pre></div>
<div class="line"><div class="doc"><p>If the iframe already has content, we want to replace its uri; if not, we want to give it a uri. This takes care of this logic.</p>
</div><pre class="source javascript"><strong class="lineNumber">191</strong>        if (this._lastURL !== url) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>If we simply assign to <code>iframe.src</code> property here, it adds an entry to the parent page&#39;s back/forward history, which we don&#39;t want. We only want to add to <code>src</code> if the iframe does not already have a page loaded (i.e. when <code>contentWindow</code> is null).</p>
</div><pre class="source javascript"><strong class="lineNumber">195</strong>            if (this.iframe.contentWindow) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">196</strong>                this.iframe.contentWindow.location.replace(url);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">197</strong>            } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">198</strong>                this.iframe.src = url;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">199</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">200</strong>            this._lastURL = url;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">201</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">202</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">203</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">204</strong>    compose(data) {</pre></div>
<div class="line"><div class="doc"><p>If we&#39;re not rendering from a saved Codeframe from the server but instead rendering a &quot;live&quot; preview, generate a data URI instead and point the iframe to that. Otherwise, just use the URL to the saved preview.</p>
</div><pre class="source javascript"><strong class="lineNumber">208</strong>        let url = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">209</strong>        if (data.liveRenderMarkup === null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">210</strong>            url = `${window.location.origin}/f/${data.htmlFrameHash}/${data.jsFrameHash}.html`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">211</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">212</strong>            url = 'data:text/html,' + encodeURIComponent(data.liveRenderMarkup);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">213</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">214</strong>        this.safelySetIframeURL(url);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">215</strong></pre></div>
<div class="line"><div class="doc"><p>We compare the new URL to the old URL here, to see whether we need to reset the <code>src</code> attribute on the iframe. If it&#39;s unchanged, we leave the iframe alone.</p>
</div><pre class="source javascript"><strong class="lineNumber">218</strong>        return jdom`&#60;div class="previewPanel" style="width:${this.paneWidth}%"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">219</strong>            ${data.liveRenderMarkup === null ? (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">220</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">221</strong>                    &#60;div class="fixed button inputContainer"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">222</strong>                        &#60;input value="${url}" onfocus="${this.selectInput}" /&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">223</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">224</strong>                    &#60;button class="button refreshButton" title="Refresh preview"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">225</strong>                        onclick="${this.handleRefresh}"&#62;&#8635;&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">226</strong>                    &#60;a class="button previewButton" title="Open preview in new tab"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">227</strong>                        target="_blank" href="${url}"&#62;Preview&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">228</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">229</strong>            ) : (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">230</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">231</strong>                    &#60;div class="unsavedWarning"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">232</strong>                        tap</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">233</strong>                        &#60;div class="fixed inline button"&#62;Save ${'&#38;'} Reload&#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">234</strong>                        to share &#60;span class="mobile-hidden"&#62;&#8594;&#60;/span&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">235</strong>                    &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">236</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">237</strong>            )}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">238</strong>            ${this.iframe}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">239</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">240</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">241</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">242</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">243</strong></pre></div>
<div class="line"><div class="doc"><p>Shorthand function that inserts a script tag with a given source and returns a promise that resolves when the script is loaded and evaluated. We use this as a minimal module loader to bootstrap loading of editor modules.</p>
</div><pre class="source javascript"><strong class="lineNumber">247</strong>const loadScript = url =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">248</strong>    const tag = document.createElement('script');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">249</strong>    tag.src = url;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">250</strong>    tag.async = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">251</strong>    return new Promise((res, _rej) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">252</strong>        tag.addEventListener('load', res);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">253</strong>        document.body.appendChild(tag);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">254</strong>    });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">255</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">256</strong></pre></div>
<div class="line"><div class="doc"><h2 id="editor-implementations">Editor implementations</h2>
</div><pre class="source javascript"><strong class="lineNumber">258</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Codeframe uses multiple different editor backends (<code>EditorCore</code> implementations) to implement the actual code editor part of Codeframe. This is because...  1. It reduces reliance on one particular third-party editor. 2. It creates an interface under which new editor backends can be added / experimented with. 3. Different editor backends are best suited for different clients.  We currently use two backends, Visual Studio Code&#39;s Monaco editor, which also runs CodeSandbox; and CodeMirror, which powers Glitch, Chrome DevTools, and more. You can also find a <em>reference implementation</em> of a bare-bones editor built on <code>&lt;textarea&gt;</code> in <code>static/js/editors/textarea.js</code>.</p>
</div><pre class="source javascript"><strong class="lineNumber">269</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Monaco-based implementation of <code>EditorCore</code></p>
</div><pre class="source javascript"><strong class="lineNumber">271</strong>class MonacoEditor {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">272</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">273</strong>    constructor(callback) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">274</strong>        this.mode = 'html';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">275</strong></pre></div>
<div class="line"><div class="doc"><p>Frames are temporary storage of loaded / saved Codeframe source files before the editor itself has been loaded and initialized.</p>
</div><pre class="source javascript"><strong class="lineNumber">278</strong>        this.frames = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">279</strong>            html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">280</strong>            javascript: ``,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">281</strong>        }</pre></div>
<div class="line"><div class="doc"><p>Monaco&#39;s core data structure backing each source file in the editor is the &quot;model&quot;. Each model represents and holds edit data, history, etc. for one file. We keep track of two and swap between them in one editor instance.</p>
</div><pre class="source javascript"><strong class="lineNumber">285</strong>        this.models = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">286</strong>            html: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">287</strong>            javascript: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">288</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">289</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">290</strong>        this.container = document.createElement('div');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">291</strong>        this.container.classList.add('editorContainer');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">292</strong>        this.monacoEditor = null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">293</strong></pre></div>
<div class="line"><div class="doc"><p>See <code>setValue()</code> to see why this exists.</p>
</div><pre class="source javascript"><strong class="lineNumber">295</strong>        this._beingSetProgrammatically = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">296</strong></pre></div>
<div class="line"><div class="doc"><p>Load the core editor module loader, and begin bootstrapping the Monaco editor loading process.</p>
</div><pre class="source javascript"><strong class="lineNumber">299</strong>        loadScript('https://unpkg.com/monaco-editor/min/vs/loader.js').then(() =&#62; this._loadEditor(callback));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">300</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">301</strong></pre></div>
<div class="line"><div class="doc"><p>Loads the rest of the Monaco editor source code and initializes the editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">303</strong>    _loadEditor(callback) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">304</strong>        require.config({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">305</strong>            paths: {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">306</strong>                vs: 'https://unpkg.com/monaco-editor/min/vs',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">307</strong>            },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">308</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">309</strong>        require(['vs/editor/editor.main'], () =&#62; {</pre></div>
<div class="line"><div class="doc"><p>Initialize models for both files</p>
</div><pre class="source javascript"><strong class="lineNumber">311</strong>            this.models.html = monaco.editor.createModel(this.frames.html, 'html');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">312</strong>            this.models.javascript = monaco.editor.createModel(this.frames.javascript, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">313</strong></pre></div>
<div class="line"><div class="doc"><p>Define a custom theme</p>
</div><pre class="source javascript"><strong class="lineNumber">315</strong>            monaco.editor.defineTheme('cf-default', {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">316</strong>                base: 'vs',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">317</strong>                inherit: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">318</strong>                rules: [</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">319</strong>                    {token: '', foreground: '000000', background: 'ffffff'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">320</strong>                    {token: 'comment', foreground: '888888', fontStyle: 'italic'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">321</strong></pre></div>
<div class="line"><div class="doc"><p>Javascript-related highlights</p>
</div><pre class="source javascript"><strong class="lineNumber">323</strong>                    {token: 'keyword', foreground: '3436bb', fontStyle: 'bold'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">324</strong>                    {token: 'type', foreground: '038c6e'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">325</strong>                    {token: 'string', foreground: 'b31515'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">326</strong>                    {token: 'number', foreground: 'ec6a40'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">327</strong></pre></div>
<div class="line"><div class="doc"><p>HTML/CSS-related highlights</p>
</div><pre class="source javascript"><strong class="lineNumber">329</strong>                    {token: 'tag', foreground: '038c6e'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">330</strong>                    {token: 'attribute.name', foreground: 'e40132'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">331</strong>                    {token: 'attribute.value.html', foreground: '3436bb'},</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">332</strong>                ],</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">333</strong>                colors: {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">334</strong>                    'editor.background': '#ffffff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">335</strong>                    'editor.lineHighlightBorder': '#f8f8f8',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">336</strong>                    'editor.lineHighlightBackground': '#f8f8f8',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">337</strong>                    'editorLineNumber.foreground': '#888888',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">338</strong>                    'editorLineNumber.activeForeground': '#333333',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">339</strong>                    'editorIndentGuide.background': '#ffffff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">340</strong>                    'editorIndentGuide.activeBackground': '#ffffff',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">341</strong>                },</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">342</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">343</strong>            monaco.editor.setTheme('cf-default');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">344</strong></pre></div>
<div class="line"><div class="doc"><p>Create one editor instance, in which we can swap between the two source file models being edited.</p>
</div><pre class="source javascript"><strong class="lineNumber">347</strong>            this.monacoEditor = monaco.editor.create(this.container, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">348</strong>                fontFamily: "'Menlo', 'Monaco', monospace",</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">349</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">350</strong>            this.setMode(this.mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">351</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">352</strong>            callback(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">353</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">354</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">355</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">356</strong>    _registerKeybindings(callbacks) {</pre></div>
<div class="line"><div class="doc"><p>For Monaco specifically, we capture the Ctrl/Cmd-S shortcut and call save on the frames being edited. This is specific to Monaco because CodeMirror does not currently have a way to extend the editor keybindings. We <em>could</em> also try to listen for different keyboard events in <code>Workspace</code> and respond accordingly from there, but that would lead to inconsistencies between browsers/OS vendors and it would depend on the editor bubbling events up.</p>
</div><pre class="source javascript"><strong class="lineNumber">364</strong>        this.monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KEY_S, callbacks.save);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">365</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">366</strong></pre></div>
<div class="line"><div class="doc"><p>The following interface methods are shared between all <code>EditorCore</code> implementations</p>
</div><pre class="source javascript"><strong class="lineNumber">368</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">369</strong>    getValue(mode = this.mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">370</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">371</strong>            return this.models[mode].getValue();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">372</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">373</strong>            return this.frames[mode];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">374</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">375</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">376</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">377</strong>    setValue(value, mode = this.mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">378</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">379</strong>            if (this.models[mode].getValue() !== value) {</pre></div>
<div class="line"><div class="doc"><p>Monaco doesn&#39;t have the ability to distinguish between changes to editor content that happens because of user-initiated edits vs. programmatic edits using <code>setValue()</code>. Since we only want to fire change event handlers for the former kind of change, we keep track of the &quot;is this a programmatic change&quot; state in this variable.</p>
</div><pre class="source javascript"><strong class="lineNumber">385</strong>                this._beingSetProgrammatically = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">386</strong>                this.models[mode].setValue(value);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">387</strong>                this._beingSetProgrammatically = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">388</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">389</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">390</strong>            this.frames[mode] = value;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">391</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">392</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">393</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">394</strong>    getMode() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">395</strong>        return this.mode;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">396</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">397</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">398</strong>    setMode(mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">399</strong>        this.mode = mode;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">400</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">401</strong>            this.monacoEditor.setModel(this.models[mode]);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">402</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">403</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">404</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">405</strong>    addChangeHandler(handler) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">406</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">407</strong>            const userChangeHandler = () =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">408</strong>                if (!this._beingSetProgrammatically) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">409</strong>                    handler();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">410</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">411</strong>            }</pre></div>
<div class="line"><div class="doc"><p>In Monaco, there isn&#39;t change events in the editor, but instead change events in the models, which we listen for.</p>
</div><pre class="source javascript"><strong class="lineNumber">414</strong>            this.models.html.onDidChangeContent(userChangeHandler);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">415</strong>            this.models.javascript.onDidChangeContent(userChangeHandler);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">416</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">417</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">418</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">419</strong>    getContainer() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">420</strong>        return this.container;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">421</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">422</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">423</strong>    resize() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">424</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">425</strong>            this.monacoEditor.layout();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">426</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">427</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">428</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">429</strong>    ready() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">430</strong>        return this.monacoEditor !== null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">431</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">432</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">433</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">434</strong></pre></div>
<div class="line"><div class="doc"><p>CodeMirror-based implementation of <code>EditorCore</code>, which is enabled on mobile browsers because Monaco is not mobile browser-compatible. This implementation is also slightly faster on slower networks.</p>
</div><pre class="source javascript"><strong class="lineNumber">438</strong>class CodeMirrorEditor {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">439</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">440</strong>    constructor(callback) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">441</strong>        this.mode = 'html';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">442</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">443</strong>        this.frames = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">444</strong>            html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">445</strong>            javascript: ``,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">446</strong>        }</pre></div>
<div class="line"><div class="doc"><p>The Document is CodeMirror&#39;s data structure for storing file and editor contents, edit history, etc. To swap between files / modes, we swap between these two documents.</p>
</div><pre class="source javascript"><strong class="lineNumber">450</strong>        this.documents = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">451</strong>            html: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">452</strong>            javascript: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">453</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">454</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">455</strong>        this.container = document.createElement('div');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">456</strong>        this.container.classList.add('editorContainer');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">457</strong>        this.codeMirrorEditor = null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">458</strong></pre></div>
<div class="line"><div class="doc"><p>This bootstraps the loading process for the CodeMirror editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">460</strong>        this._loadEditor(callback);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">461</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">462</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">463</strong>    async _loadEditor(callback) {</pre></div>
<div class="line"><div class="doc"><p>We fix the version number here because CM 6 is going to have breaking API changes, and it&#39;s unclear at time of writing if that&#39;ll be released under the same package.</p>
</div><pre class="source javascript"><strong class="lineNumber">467</strong>        const EDITOR_SCRIPT_ROOT = 'https://unpkg.com/codemirror@5';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">468</strong>        const EDITOR_SCRIPT_SRC = EDITOR_SCRIPT_ROOT + '/lib/codemirror.js';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">469</strong>        const LANG_SCRIPT_SRC = [</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">470</strong>            'javascript',</pre></div>
<div class="line"><div class="doc"><p><code>xml</code> and <code>css</code> are dependencies of <code>htmlmixed</code>, the standalone (not embedded) HTML language mode for CM.</p>
</div><pre class="source javascript"><strong class="lineNumber">473</strong>            'xml',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">474</strong>            'css',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">475</strong>            'htmlmixed',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">476</strong>        ].map(mode =&#62; `${EDITOR_SCRIPT_ROOT}/mode/${mode}/${mode}.js`);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">477</strong>        const AUX_SRC = [</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">478</strong>            'edit/closetag.js',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">479</strong>            'edit/closebrackets.js',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">480</strong>        ].map(path =&#62; `${EDITOR_SCRIPT_ROOT}/addon/${path}`);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">481</strong></pre></div>
<div class="line"><div class="doc"><p>CodeMirror has an accompanying stylesheet. We load this manually here.</p>
</div><pre class="source javascript"><strong class="lineNumber">483</strong>        const styleLink = document.createElement('link');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">484</strong>        styleLink.rel = 'stylesheet';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">485</strong>        styleLink.href = EDITOR_SCRIPT_ROOT + '/lib/codemirror.css';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">486</strong>        document.head.appendChild(styleLink);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">487</strong></pre></div>
<div class="line"><div class="doc"><p>These must load in this order -- language modes must load after the core editor is loaded, but once the core editor is loaded, everything else can load in parallel.</p>
</div><pre class="source javascript"><strong class="lineNumber">491</strong>        await loadScript(EDITOR_SCRIPT_SRC);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">492</strong>        await Promise.all([</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">493</strong>            ...LANG_SCRIPT_SRC,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">494</strong>            ...AUX_SRC,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">495</strong>        ].map(loadScript));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">496</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">497</strong>        this.documents.html = CodeMirror.Doc(this.frames.html, 'htmlmixed');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">498</strong>        this.documents.javascript = CodeMirror.Doc(this.frames.javascript, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">499</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">500</strong>        this.codeMirrorEditor = CodeMirror(this.container, {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">501</strong>            indentUnit: 4,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">502</strong>            tabSize: 4,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">503</strong>            lineWrapping: false,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">504</strong>            lineNumbers: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">505</strong>            indentWithTabs: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">506</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">507</strong>            // provided by edit/closetag.js</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">508</strong>            autoCloseTags: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">509</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">510</strong>            // provided by edit/closebrackets.js</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">511</strong>            autoCloseBrackets: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">512</strong>        });</pre></div>
<div class="line"><div class="doc"><p>We swap the document in after instantiation rather than in creation, because the latter option strips the document of its language mode. This seems like a poorly documented behavior of CM.</p>
</div><pre class="source javascript"><strong class="lineNumber">516</strong>        this.setMode(this.mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">517</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">518</strong>        callback(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">519</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">520</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">521</strong>    getValue(mode = this.mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">522</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">523</strong>            return this.documents[mode].getValue();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">524</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">525</strong>            return this.frames[mode];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">526</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">527</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">528</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">529</strong>    setValue(value, mode = this.mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">530</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">531</strong>            if (this.documents[mode].getValue() !== value) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">532</strong>                this.documents[mode].setValue(value);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">533</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">534</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">535</strong>            this.frames[mode] = value;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">536</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">537</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">538</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">539</strong>    getMode() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">540</strong>        return this.mode;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">541</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">542</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">543</strong>    setMode(mode) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">544</strong>        this.mode = mode;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">545</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">546</strong>            this.codeMirrorEditor.swapDoc(this.documents[mode]);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">547</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">548</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">549</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">550</strong>    addChangeHandler(handler) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">551</strong>        if (this.ready()) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">552</strong>            this.codeMirrorEditor.on('changes', (_, changeEvent) =&#62; {</pre></div>
<div class="line"><div class="doc"><p>We want to avoid triggering change events not generated directly from user input. i.e. we don&#39;t want to hit change handlers when we reload or reroute.</p>
</div><pre class="source javascript"><strong class="lineNumber">556</strong>                if (changeEvent[0].origin !== 'setValue') {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">557</strong>                    handler();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">558</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">559</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">560</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">561</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">562</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">563</strong>    getContainer() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">564</strong>        return this.container;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">565</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">566</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">567</strong>    resize() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">568</strong>        this.codeMirrorEditor.setSize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">569</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">570</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">571</strong>    ready() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">572</strong>        return this.codeMirrorEditor !== null;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">573</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">574</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">575</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">576</strong></pre></div>
<div class="line"><div class="doc"><p>Depending on the client, pick the editor implementation that provides the best experience.</p>
</div><pre class="source javascript"><strong class="lineNumber">578</strong>const EditorCore = navigator.userAgent.match(/(Android|iPhone|iPad|iPod)/) ? CodeMirrorEditor : MonacoEditor;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">579</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>Editor</code> component encapsulates the editor (currently Monaco or CodeMirror), all file state and undo/redo histories, syntax highlights and other state about the files the user is editing.</p>
</div><pre class="source javascript"><strong class="lineNumber">583</strong>class Editor extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">584</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">585</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>Percentage of the editor size that the editor pane takes up.</p>
</div><pre class="source javascript"><strong class="lineNumber">587</strong>        this.paneWidth = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">588</strong></pre></div>
<div class="line"><div class="doc"><p>Initial values for extra settings</p>
</div><pre class="source javascript"><strong class="lineNumber">590</strong>        this.settings = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Is the config bar visible?</p>
</div><pre class="source javascript"><strong class="lineNumber">592</strong>            visible: false,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>Is the as-you-type live reload enabled?</p>
</div><pre class="source javascript"><strong class="lineNumber">594</strong>            asYouTypeEnabled: true,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">595</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">596</strong></pre></div>
<div class="line"><div class="doc"><p>Frame hashes of the last-saved editor values, to see if we need to re-fetch frame file values when the route changes.</p>
</div><pre class="source javascript"><strong class="lineNumber">599</strong>        this._lastHash = '';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">600</strong>        this.initEditorCore();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">601</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">602</strong>        this.bind(frameRecord, data =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">603</strong>            this.fetchFrames(data);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">604</strong>            this.render(data);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">605</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">606</strong></pre></div>
<div class="line"><div class="doc"><p>We deep link to the editor tab using the URL hash, so restore the state here from when the page first loaded.</p>
</div><pre class="source javascript"><strong class="lineNumber">609</strong>        if (loadedURLState.tab !== '') {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">610</strong>            this.switchMode(loadedURLState.tab);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">611</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">612</strong></pre></div>
<div class="line"><div class="doc"><p>Any calls to <code>resizeEditor</code> should be debounced to 250ms. This is negligible to UX in fast modern laptops, but has a noticeable impact on UX for lower-end devices.</p>
</div><pre class="source javascript"><strong class="lineNumber">615</strong>        this.resizeEditor = debounce(this.resizeEditor.bind(this), 250);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">616</strong>        window.addEventListener('resize', this.resizeEditor);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">617</strong></pre></div>
<div class="line"><div class="doc"><p>We create these two methods that are versions of <code>switchMode</code> bound to specific editing modes, for easier use later on in <code>compose()</code>.</p>
</div><pre class="source javascript"><strong class="lineNumber">620</strong>        this.switchHTMLMode = this.switchMode.bind(this, 'html');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">621</strong>        this.switchJSMode = this.switchMode.bind(this, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">622</strong>        this.saveFrames = this.saveFrames.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">623</strong></pre></div>
<div class="line"><div class="doc"><p>Bind other methods used as callbacks</p>
</div><pre class="source javascript"><strong class="lineNumber">625</strong>        this.toggleSettings = this.toggleSettings.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">626</strong>        this.toggleAsYouType = this.toggleAsYouType.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">627</strong></pre></div>
<div class="line"><div class="doc"><p>Live-rendering (previewing unsaved changes) should be debounced, since we don&#39;t want to re-render the iframe with every keystroke, for example. But we leave an escape hatch with *Immediate for forced re-renders, etc.</p>
</div><pre class="source javascript"><strong class="lineNumber">631</strong>        this.liveRenderFramesImmediate = this.liveRenderFrames.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">632</strong>        this.liveRenderFrames = debounce(this.liveRenderFramesImmediate, 750);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">633</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">634</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">635</strong>    remove() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">636</strong>        window.removeEventListener('resize', this.resizeEditor)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">637</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">638</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">639</strong>    setWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">640</strong>        this.paneWidth = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">641</strong>        this.resizeEditor();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">642</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">643</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">644</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">645</strong>    fetchFrames(data) {</pre></div>
<div class="line"><div class="doc"><p><code>fetchFrames</code> is in charge of (1) determining based on new data whether we need to re-fetch HTML and JS files for the current version of the Codeframe (or if we have it already) and making those requests and saving the results to the view state. We are careful here to first check if the frames we are looking to fetch aren&#39;t the ones already saved in the editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">650</strong>        if (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">651</strong>            data.htmlFrameHash + data.jsFrameHash !== this._lastHash</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">652</strong>            &#38;&#38; data.htmlFrameHash</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">653</strong>        ) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">654</strong>            this._lastHash = data.htmlFrameHash + data.jsFrameHash;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">655</strong>            api.get(`/frame/${data.htmlFrameHash}`).then(resp =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">656</strong>                return resp.text();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">657</strong>            }).then(result =&#62; {</pre></div>
<div class="line"><div class="doc"><p>This checks against a race bug, where more recent &quot;live&quot; edits have been made since we began to fetch frames.</p>
</div><pre class="source javascript"><strong class="lineNumber">660</strong>                if (this.record.get('liveRenderMarkup') === null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">661</strong>                    this.core.setValue(result, 'html');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">662</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">663</strong>            }).catch(e =&#62; api.errlog(e));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">664</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">665</strong>            api.get(`/frame/${data.jsFrameHash}`).then(resp =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">666</strong>                return resp.text();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">667</strong>            }).then(result =&#62; {</pre></div>
<div class="line"><div class="doc"><p>This checks against a race bug. See above.</p>
</div><pre class="source javascript"><strong class="lineNumber">669</strong>                if (this.record.get('liveRenderMarkup') === null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">670</strong>                    this.core.setValue(result, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">671</strong>                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">672</strong>            }).catch(e =&#62; api.errlog(e));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">673</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">674</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">675</strong></pre></div>
<div class="line"><div class="doc"><p>Initialize the given editor implementation.</p>
</div><pre class="source javascript"><strong class="lineNumber">677</strong>    initEditorCore() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">678</strong>        this.core = new EditorCore(core =&#62; {</pre></div>
<div class="line"><div class="doc"><p>Here we populate potential prefilled values from the URL query strings, and force-live-render it into the preview to make those dirty changes visible without saving these examples to the server.</p>
</div><pre class="source javascript"><strong class="lineNumber">682</strong>            if (loadedURLState.html || loadedURLState.js) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">683</strong>                core.setValue(loadedURLState.html, 'html');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">684</strong>                core.setValue(loadedURLState.js, 'javascript');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">685</strong>                this.liveRenderFramesImmediate();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">686</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">687</strong>            core.addChangeHandler(this.liveRenderFrames);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">688</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">689</strong>            // Monaco-specific, so this isn't super clean, but is the best</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">690</strong>            // solution I could come up with without breaking encapsulation</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">691</strong>            // of the EditorCore interface..</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">692</strong>            if ('_registerKeybindings' in core) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">693</strong>                core._registerKeybindings({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">694</strong>                    save: this.saveFrames,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">695</strong>                });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">696</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">697</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">698</strong>            this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">699</strong>            this.resizeEditor();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">700</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">701</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">702</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">703</strong>    resizeEditor() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">704</strong>        this.core.resize();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">705</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">706</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">707</strong>    switchMode(mode) {</pre></div>
<div class="line"><div class="doc"><p>When we switch modes, we have to first save the value of the file being edited, then switch out the underlying file model.</p>
</div><pre class="source javascript"><strong class="lineNumber">710</strong>        this.core.setMode(mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">711</strong>        this.render();</pre></div>
<div class="line"><div class="doc"><p>We deep link to the editor tab using the URL hash, so save the new mode state to the hash.</p>
</div><pre class="source javascript"><strong class="lineNumber">714</strong>        window.history.replaceState(null, document.title, '#' + mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">715</strong>        gevent('editor', 'switchmode', mode);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">716</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">717</strong></pre></div>
<div class="line"><div class="doc"><p><code>liveRenderFrames()</code> is called when the editor content changes, to client-side refresh the iframe preview contents.</p>
</div><pre class="source javascript"><strong class="lineNumber">720</strong>    liveRenderFrames() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">721</strong>        if (!this.settings.asYouTypeEnabled) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">722</strong>            return;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">723</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">724</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">725</strong>        const documentMarkup = `&#60;!DOCTYPE html&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">726</strong>&#60;html&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">727</strong>    &#60;head&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">728</strong>        &#60;meta charset="utf-8"/&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">729</strong>        &#60;meta name="viewport" content="width=device-width,initial-scale=1"/&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">730</strong>        &#60;title&#62;Live Frame | Codeframe&#60;/title&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">731</strong>    &#60;/head&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">732</strong>    &#60;body&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">733</strong>        ${this.core.getValue('html')}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">734</strong>        &#60;script src="https://unpkg.com/torus-dom/dist/index.min.js"&#62;&#60;/script&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">735</strong>        &#60;script&#62;${this.core.getValue('javascript')}&#60;/script&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">736</strong>    &#60;/body&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">737</strong>&#60;/html&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">738</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">739</strong>        this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">740</strong>            liveRenderMarkup: documentMarkup,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">741</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">742</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">743</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">744</strong>    toggleSettings() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">745</strong>        this.settings.visible = !this.settings.visible;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">746</strong>        this.render();</pre></div>
<div class="line"><div class="doc"><p>The settings bar changes the editor view size, so we need to re-layout the editor after render.</p>
</div><pre class="source javascript"><strong class="lineNumber">749</strong>        this.resizeEditor();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">750</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">751</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">752</strong>    toggleAsYouType() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">753</strong>        this.settings.asYouTypeEnabled = !this.settings.asYouTypeEnabled;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">754</strong>        this.render();</pre></div>
<div class="line"><div class="doc"><p>In case there are any current dirty changes when this is toggled on...</p>
</div><pre class="source javascript"><strong class="lineNumber">756</strong>        if (this.settings.asYouTypeEnabled) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">757</strong>            this.liveRenderFramesImmediate();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">758</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">759</strong>        gevent('editor', 'settings.asyoutype', this.settings.asYouTypeEnabled.toString());</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">760</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">761</strong></pre></div>
<div class="line"><div class="doc"><p><code>saveFrames</code> handles saving / persisting Codeframe files to the backend service, and returns a promise that resolves only once all frame files have been saved.</p>
</div><pre class="source javascript"><strong class="lineNumber">764</strong>    async saveFrames() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">765</strong>        const hashes = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">766</strong>            html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">767</strong>            js: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">768</strong>        }</pre></div>
<div class="line"><div class="doc"><p>This is a nice way to make the function hang (not resolve its returned Promise) until all of its requests have resolved.</p>
</div><pre class="source javascript"><strong class="lineNumber">771</strong>        await Promise.all([</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">772</strong>            api.post('/frame/', this.core.getValue('html'))</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">773</strong>                .then(resp =&#62; resp.text())</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">774</strong>                .then(hash =&#62; hashes.html = hash)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">775</strong>                .catch(e =&#62; api.errlog(e)),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">776</strong>            api.post('/frame/', this.core.getValue('javascript'))</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">777</strong>                .then(resp =&#62; resp.text())</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">778</strong>                .then(hash =&#62; hashes.js = hash)</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">779</strong>                .catch(e =&#62; api.errlog(e)),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">780</strong>        ]);</pre></div>
<div class="line"><div class="doc"><p>Once we&#39;ve saved the current frames, open the new frames up in the preview pane by going to this route with the new frames.</p>
</div><pre class="source javascript"><strong class="lineNumber">783</strong>        const route = `/h/${hashes.html}/j/${hashes.js}/edit`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">784</strong>        if (window.location.pathname.startsWith(route)) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">785</strong>            this.record.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">786</strong>                liveRenderMarkup: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">787</strong>            });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">788</strong>        } else {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">789</strong>            router.go(route);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">790</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">791</strong>        gevent('editor', 'save');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">792</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">793</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">794</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">795</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">796</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">797</strong>        flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">798</strong>        flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">799</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">800</strong>        border-left: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">801</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">802</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">803</strong>        @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">804</strong>            /* Overriding inline style */</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">805</strong>            width: 100% !important;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">806</strong>            height: 50%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">807</strong>            border-left: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">808</strong>            border-top: 2px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">809</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">810</strong>        .topBar {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">811</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">812</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">813</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">814</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">815</strong>            padding: 0 3px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">816</strong>            border-bottom: 4px dotted var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">817</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">818</strong>            height: 52px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">819</strong>            overflow-x: auto;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">820</strong>            .embedded &#38; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">821</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">822</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">823</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">824</strong>        .buttonGroup {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">825</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">826</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">827</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">828</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">829</strong>        .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">830</strong>            font-size: .75rem;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">831</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">832</strong>        .editorContainer .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">833</strong>            border: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">834</strong>            background: transparent;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">835</strong>            height: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">836</strong>            width: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">837</strong>            &#38;::before,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">838</strong>            &#38;::after {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">839</strong>                display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">840</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">841</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">842</strong>        .editorContainer,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">843</strong>        .ready {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">844</strong>            width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">845</strong>            /* dummy size, flex will resize</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">846</strong>             * but CodeMirror needs a set size.</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">847</strong>             * set to 0 to avoid flex oversize</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">848</strong>             * issues on Android Chrome on focus */</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">849</strong>            height: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">850</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">851</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">852</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">853</strong>        .ready {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">854</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">855</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">856</strong>            justify-content: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">857</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">858</strong>            color: #555;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">859</strong>            em {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">860</strong>                display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">861</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">862</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">863</strong>        .CodeMirror {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">864</strong>            height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">865</strong>            font-family: 'Menlo', 'Monaco', 'Courier', monospace;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">866</strong>            font-size: 12px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">867</strong>            line-height: 1.5em;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">868</strong>            &#38;-gutters {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">869</strong>                background: #fff;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">870</strong>                border-right: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">871</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">872</strong>            &#38;-lines {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">873</strong>                padding-bottom: 60vh;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">874</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">875</strong>            &#38;-cursor {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">876</strong>                border-width: 2px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">877</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">878</strong>            &#38;-linenumber {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">879</strong>                padding-right: 12px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">880</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">881</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">882</strong>            span.cm-comment {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">883</strong>                color: #888;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">884</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">885</strong>            span.cm-keyword {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">886</strong>                color: #3436bb;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">887</strong>                font-weight: bold;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">888</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">889</strong>            span.cm-def {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">890</strong>                color: #038c6e;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">891</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">892</strong>            span.cm-string,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">893</strong>            span.cm-string-2 {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">894</strong>                color: #b31515;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">895</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">896</strong>            span.cm-number {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">897</strong>                color: #ec6140;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">898</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">899</strong>            span.cm-tag {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">900</strong>                color: #038c6e;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">901</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">902</strong>            span.cm-attribute {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">903</strong>                color: #e40132;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">904</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">905</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">906</strong>        textarea.editorContainer {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">907</strong>            font-family: 'Menlo', 'Monaco', 'Courier', monospace;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">908</strong>            font-size: 12px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">909</strong>            line-height: 16px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">910</strong>            box-sizing: border-box;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">911</strong>            padding: 4px 8px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">912</strong>            -webkit-overflow-scrolling: touch;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">913</strong>            padding-bottom: 60vh;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">914</strong>            &#38;:focus {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">915</strong>                outline: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">916</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">917</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">918</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">919</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">920</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">921</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">922</strong>        const mode = this.core.getMode();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">923</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">924</strong>        return jdom`&#60;div class="editor" style="width:${this.paneWidth}%"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">925</strong>            &#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">926</strong>                &#60;div class="buttonGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">927</strong>                    &#60;button</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">928</strong>                        class="button ${mode === 'html' ? 'active' : ''} tab-html"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">929</strong>                        title="Switch to HTML editor"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">930</strong>                        onclick="${this.switchHTMLMode}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">931</strong>                        HTML</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">932</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">933</strong>                    &#60;button</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">934</strong>                        class="button ${mode === 'javascript' ? 'active' : ''} tab-js"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">935</strong>                        title="Switch to JavaScript editor"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">936</strong>                        onclick="${this.switchJSMode}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">937</strong>                        JavaScript</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">938</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">939</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">940</strong>                &#60;div class="buttonGroup"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">941</strong>                    &#60;button class="button ${this.settings.visible ? 'active' : ''}" title="Show additional settings"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">942</strong>                        onclick="${this.toggleSettings}"&#62;...&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">943</strong>                    &#60;button class="button" title="Save Codeframe and reload preview"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">944</strong>                        onclick="${this.saveFrames}"&#62;Save ${'&#38;'} Reload&#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">945</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">946</strong>            &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">947</strong>            ${this.settings.visible ? (</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">948</strong>                jdom`&#60;div class="topBar"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">949</strong>                    &#60;button class="button ${this.settings.asYouTypeEnabled ? 'active' : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">950</strong>                        title="Turn on or off live-reloading as you type"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">951</strong>                        onclick="${this.toggleAsYouType}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">952</strong>                        Reload as you type</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">953</strong>                        ${this.settings.asYouTypeEnabled ? '(on)' : '(off)'}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">954</strong>                    &#60;/button&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">955</strong>                &#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">956</strong>            ) : null}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">957</strong>            ${this.core.ready() ? this.core.getContainer() : (</pre></div>
<div class="line"><div class="doc"><p>If the editor is not yet available (is still loading), show a placeholder bit of text.</p>
</div><pre class="source javascript"><strong class="lineNumber">960</strong>                jdom`&#60;div class="ready"&#62;&#60;em&#62;Getting your editor ready...&#60;/em&#62;&#60;/div&#62;`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">961</strong>            )}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">962</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">963</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">964</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">965</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">966</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>Workspace</code> component is the &quot;Codeframe editor&quot;. That is to say, this is the component that wraps everything into a neat, interactive page and is the backbone of the Codeframe editing experience.</p>
</div><pre class="source javascript"><strong class="lineNumber">970</strong>class Workspace extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">971</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">972</strong>    init(frameRecord) {</pre></div>
<div class="line"><div class="doc"><p>The left/right panes are split 50/50 between its two panes.</p>
</div><pre class="source javascript"><strong class="lineNumber">974</strong>        this.paneSplit = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">975</strong>        this.preview = new PreviewPane(frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">976</strong>        this.editor = new Editor(frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">977</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">978</strong>        this.bind(frameRecord, data =&#62; this.render(data));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">979</strong></pre></div>
<div class="line"><div class="doc"><p><code>this.grabDragging</code> represents whether there is currently a drag-to-resize-panes interaction happening.</p>
</div><pre class="source javascript"><strong class="lineNumber">982</strong>        this.grabDragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">983</strong>        this.handleGrabMousedown = this.handleGrabMousedown.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">984</strong>        this.handleGrabMousemove = this.handleGrabMousemove.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">985</strong>        this.handleGrabMouseup = this.handleGrabMouseup.bind(this);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">986</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">987</strong>        window.addEventListener('beforeunload', evt =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">988</strong>            if (this.record.get('liveRenderMarkup') !== null) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">989</strong>                evt.returnValue = 'You have unsaved changes to your Codeframe. Are you sure you want to leave?';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">990</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">991</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">992</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">993</strong></pre></div>
<div class="line"><div class="doc"><p>Shortcut method to set the sizes of children components, given one split percentage.</p>
</div><pre class="source javascript"><strong class="lineNumber">996</strong>    setPaneWidth(width) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber"></strong></pre></div>
<div class="line"><div class="doc"><p>These cases implement &quot;snapping&quot; of panes to 0, 50, 100% increments, with 1% buffer around each snap point.</p>
</div><pre class="source javascript"><strong class="lineNumber">999</strong>        if (width &#60; 1) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1000</strong>            width = 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1001</strong>        } else if (width &#62; 99) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1002</strong>            width = 100;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1003</strong>        } else if (width &#62; 49 &#38;&#38; width &#60; 51) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1004</strong>            width = 50;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1005</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1006</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1007</strong>        this.paneSplit = width;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1008</strong>        this.preview.setWidth(width);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1009</strong>        this.editor.setWidth(100 - width);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1010</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1011</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1012</strong></pre></div>
<div class="line"><div class="doc"><p>What follows are mouse/pointer event handlers to make resizing a smooth experience.</p>
</div><pre class="source javascript"><strong class="lineNumber">1015</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1016</strong>    handleGrabMousedown() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1017</strong>        this.grabDragging = true;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1018</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1019</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1020</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1021</strong>    handleGrabMousemove(evt) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1022</strong>        if (this.grabDragging) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1023</strong>            if (!evt.defaultPrevented) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1024</strong>                evt.preventDefault();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1025</strong>            }</pre></div>
<div class="line"><div class="doc"><p>If the event is a touch event, get the <code>clientX</code> of the first touch point, not the whole event.</p>
</div><pre class="source javascript"><strong class="lineNumber">1028</strong>            if (evt.touches) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1029</strong>                evt = evt.touches[0];</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1030</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1031</strong>            this.setPaneWidth(evt.clientX / window.innerWidth * 100);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1032</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1033</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1034</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1035</strong>    handleGrabMouseup() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1036</strong>        this.grabDragging = false;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1037</strong>        this.render();</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1038</strong>        gevent('workspace', 'resize', 'editor', this.paneSplit);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1039</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1040</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1041</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1042</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1043</strong>        width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1044</strong>        height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1045</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1046</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1047</strong>        header {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1048</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1049</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1050</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1051</strong>            align-items: center;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1052</strong>            flex-shrink: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1053</strong>            padding: 4px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1054</strong>            background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1055</strong>            border-bottom: 4px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1056</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1057</strong>        &#38;.embedded header {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1058</strong>            display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1059</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1060</strong>        nav {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1061</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1062</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1063</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1064</strong>            overflow-x: auto;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1065</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1066</strong>        main {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1067</strong>            display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1068</strong>            flex-direction: row;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1069</strong>            justify-content: space-between;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1070</strong>            align-items: flex-start;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1071</strong>            flex-grow: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1072</strong>            flex-shrink: 1;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1073</strong>            overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1074</strong>            position: relative;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1075</strong>            height: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1076</strong>            @media (max-width: 750px) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1077</strong>                flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1078</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1079</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1080</strong>        .button {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1081</strong>            white-space: nowrap;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1082</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1083</strong>        .newButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1084</strong>            color: var(--cf-accent);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1085</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1086</strong>        .grabHandle {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1087</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1088</strong>            top: 50%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1089</strong>            left: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1090</strong>            transform: translate(-50%, -50%);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1091</strong>            border-radius: 4px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1092</strong>            width: 8px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1093</strong>            height: 56px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1094</strong>            background: #fff;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1095</strong>            border: 3px solid var(--cf-black);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1096</strong>            cursor: ew-resize;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1097</strong>            z-index: 2000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1098</strong>            &#38;:hover {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1099</strong>                background: var(--cf-background);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1100</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1101</strong>            &#38;:active {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1102</strong>                background: var(--cf-accent);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1103</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1104</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1105</strong>        .grabHandleShadow {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1106</strong>            background: rgba(0, 0, 0, .1);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1107</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1108</strong>            top: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1109</strong>            left: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1110</strong>            right: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1111</strong>            bottom: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1112</strong>            z-index: 1000;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1113</strong>            transition: opacity .3s;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1114</strong>            cursor: ew-resize;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1115</strong>            &#38;.hidden {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1116</strong>                opacity: 0;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1117</strong>                pointer-events: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1118</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1119</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1120</strong>        .fullButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1121</strong>            display: none;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1122</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1123</strong>        &#38;.embedded .fullButton {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1124</strong>            display: block;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1125</strong>            position: absolute;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1126</strong>            top: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1127</strong>            left: unset;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1128</strong>            bottom: 2px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1129</strong>            right: 6px;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1130</strong>            font-size: .75em;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1131</strong>            z-index: 100;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1132</strong>        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1133</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1134</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1135</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1136</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1137</strong>        return jdom`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1138</strong>        &#60;div class="workspace ${window.frameElement === null ? '' : 'embedded'}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1139</strong>            ontouchmove="${this.grabDragging ? this.handleGrabMousemove : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1140</strong>            ontouchend="${this.grabDragging ? this.handleGrabMouseup : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1141</strong>            onmousemove="${this.grabDragging ? this.handleGrabMousemove : ''}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1142</strong>            onmouseup="${this.grabDragging ? this.handleGrabMouseup : ''}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1143</strong>            &#60;header&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1144</strong>                &#60;div class="logo"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1145</strong>                    &#60;a class="button" href="/"&#62;Codeframe&#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1146</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1147</strong>                &#60;nav&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1148</strong>                    &#60;a class="button newButton" href="/new?from=editor"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1149</strong>                        + New &#60;span class="mobile-hidden"&#62;Codeframe&#60;/span&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1150</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1151</strong>                    &#60;a class="button tiny-hidden" href="https://twitter.com/thesephist" target="_blank"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1152</strong>                        &#60;span class="mobile-hidden"&#62;Made by&#60;/span&#62; @thesephist</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1153</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1154</strong>                    &#60;a class="button" href="https://github.com/thesephist/codeframe" target="_blank"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1155</strong>                        &#60;span class="mobile-hidden"&#62;View Source on&#60;/span&#62; GitHub</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1156</strong>                    &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1157</strong>                &#60;/nav&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1158</strong>            &#60;/header&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1159</strong>            &#60;main&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1160</strong>                ${this.preview.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1161</strong>                ${this.editor.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1162</strong>                &#60;a class="button fullButton"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1163</strong>                    title="Open this editor in a new tab"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1164</strong>                    target="_blank"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1165</strong>                    href="${window.location.href}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1166</strong>                    Open in new tab</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1167</strong>                &#60;/a&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1168</strong>                &#60;div class="grabHandleShadow ${this.grabDragging ? '' : 'hidden'}"&#62;&#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1169</strong>                &#60;div</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1170</strong>                    title="Resize editor panes"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1171</strong>                    class="grabHandle mobile-hidden"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1172</strong>                    style="left:${this.paneSplit}%"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1173</strong>                    ontouchstart="${this.handleGrabMousedown}"</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1174</strong>                    onmousedown="${this.handleGrabMousedown}"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1175</strong>                &#60;/div&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1176</strong>            &#60;/main&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1177</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1178</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1179</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1180</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1181</strong></pre></div>
<div class="line"><div class="doc"><p>The <code>App</code> component simply wraps around the <code>Workspace</code> to provide routing and a container for the workspace.</p>
</div><pre class="source javascript"><strong class="lineNumber">1184</strong>class App extends StyledComponent {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1185</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1186</strong>    init(router) {</pre></div>
<div class="line"><div class="doc"><p>This <code>frameRecord</code> becomes the view model for most views in the editor.</p>
</div><pre class="source javascript"><strong class="lineNumber">1189</strong>        this.frameRecord = new Record({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1190</strong>            htmlFrameHash: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1191</strong>            jsFrameHash: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1192</strong>            liveRenderMarkup: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1193</strong>        });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1194</strong>        this.workspace = new Workspace(this.frameRecord);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1195</strong></pre></div>
<div class="line"><div class="doc"><p>Routing logic.</p>
</div><pre class="source javascript"><strong class="lineNumber">1197</strong>        this.bind(router, ([name, params]) =&#62; {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1198</strong>            switch (name) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1199</strong>                case 'edit':</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1200</strong>                    this.frameRecord.update({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1201</strong>                        htmlFrameHash: params.htmlFrameHash,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1202</strong>                        jsFrameHash: params.jsFrameHash,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1203</strong>                        liveRenderMarkup: null,</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1204</strong>                    });</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1205</strong>                    break;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1206</strong>                case 'welcome':</pre></div>
<div class="line"><div class="doc"><p>This is a predetermined URL that points to the welcome Codeframe.</p>
</div><pre class="source javascript"><strong class="lineNumber">1208</strong>                    router.go('/h/34257cad6ac3/j/e3b0c44298fc/edit', {replace: true});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1209</strong>                    break;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1210</strong>                default:</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1211</strong>                    {</pre></div>
<div class="line"><div class="doc"><p>If there are prefilled HTML and JavaScript values provided in the query string, parse and save it for later when the editor loads.</p>
</div><pre class="source javascript"><strong class="lineNumber">1215</strong>                        const searchPart = window.location.search.substr(1);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1216</strong>                        if (searchPart) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1217</strong>                            for (const pair of searchPart.split('&#38;')) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1218</strong>                                const idx = pair.indexOf('=');</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1219</strong>                                const langPart = pair.substr(0, idx);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1220</strong>                                if (langPart in loadedURLState) {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1221</strong>                                    loadedURLState[langPart] = decodeURIComponent(pair.substr(idx + 1));</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1222</strong>                                }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1223</strong>                            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1224</strong>                        }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1225</strong>                    }</pre></div>
<div class="line"><div class="doc"><p>When we redirect some URL right on page load, we want that new URL to <em>replace</em> the old, given URL value, not append a new history entry. So replace the history entry, not append. In this case, we redirect to the URL of an empty Codeframe</p>
</div><pre class="source javascript"><strong class="lineNumber">1230</strong>                    router.go(`/h/e3b0c44298fc/j/e3b0c44298fc/edit`, {replace: true});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1231</strong>                    break;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1232</strong>            }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1233</strong>        })</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1234</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1235</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1236</strong>    styles() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1237</strong>        return css`</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1238</strong>        width: 100%;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1239</strong>        height: 100vh;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1240</strong>        display: flex;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1241</strong>        flex-direction: column;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1242</strong>        overflow: hidden;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1243</strong>        `;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1244</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1245</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1246</strong>    compose() {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1247</strong>        return jdom`&#60;div id="root"&#62;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1248</strong>            ${this.workspace.node}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1249</strong>        &#60;/div&#62;`;</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1250</strong>    }</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1251</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1252</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1253</strong></pre></div>
<div class="line"><div class="doc"><p>Used to save some global values for when the URL contains a pre-populated code sample or tab state saved in the hash.</p>
</div><pre class="source javascript"><strong class="lineNumber">1256</strong>const loadedURLState = {</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1257</strong>    html: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1258</strong>    js: '',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1259</strong>    tab: window.location.hash.substr(1),</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1260</strong>}</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1261</strong></pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1262</strong>const router = new Router({</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1263</strong>    edit: '/h/:htmlFrameHash/j/:jsFrameHash/edit',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1264</strong>    welcome: '/welcome',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1265</strong>    default: '/new',</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1266</strong>});</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1267</strong></pre></div>
<div class="line"><div class="doc"><p>Create a new instance of the editor app and mount it to the DOM.</p>
</div><pre class="source javascript"><strong class="lineNumber">1269</strong>const app = new App(router);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1270</strong>document.body.appendChild(app.node);</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1271</strong></pre></div>
<div class="line"><div class="doc"><p>Since the editor is a full-window app, we don&#39;t want any overflows to make the app unnecessary scrollable beyond its viewport.</p>
</div><pre class="source javascript"><strong class="lineNumber">1274</strong>document.body.style.overflow = 'hidden';</pre></div>
<div class="line"><div class="doc"></div><pre class="source javascript"><strong class="lineNumber">1275</strong></pre></div>
    </main>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github-gist.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>
        for (const el of document.querySelectorAll('.line pre')) {
            hljs.highlightBlock(el);
        }
    </script>
</body>

</html>